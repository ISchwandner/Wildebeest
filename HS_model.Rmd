---
title: "Habitat_Suitability_Model_10-13"
author: "Imogen Schwandner -2671952S"
date: '2022-06-08'
output: html_document
---

A habitat-suitability model based on wildebeest GPS tracking data from 2010-2013. Built in a logistic regression framework with a logit link, based on location fixes as presences and pseudo-absences. Pseudo absences will be randomly generated i=within a buffer of the maximum obsoverd step length of any animal in the data set.

```{r message=FALSE, warning=FALSE}
library(rgeos)
library(rgdal)
library(sp)
library(dplyr)
library(tidyverse)
library(raster)
library(sf)
library(amt)
#library(lme4)
```

1. Load wildebeest data and covariate layers and Pseudo-Absense Points

```{r}
load("WB_and_Covariates_data.RData")
load("PointsPoints1.RData")
```


_. Editing WBS data to keep only columns of interest for HBS model

```{r}
WBS@data <- WBS@data[, c(1,22)]
```

_. Extracting Covariates for Presence-Points

_._. Creating a raster stack


```{r}
WBS_stack <- stack(anthro, D_river, D_roadT1, D_roadT5, D_wood, TWI)
```

_._ Extract Covariates for WBS _Presence Points

```{r}
rasValue <- extract(WBS_stack, WBS)
```

_._ Convert to data frame and join raster Values

```{r}
WBS_RSF <- as.data.frame(WBS)

WBS_RSF <- cbind(WBS_RSF, rasValue)
```

```{r}
# Create P/A column with value 1
WBS_RSF$PA <- 1
```

_._ Extract Covariates for Pseudo-Absences

```{r}
rasValue1 <- extract(WBS_stack, Points)
```

_._ Convert to data frame and join raster Values

```{r}
Points_RSF <- as.data.frame(Points)

Points_RSF <- cbind(Points_RSF, rasValue1)
```

```{r}
# Create P/A column with value 1
Points_RSF$PA <- 0
```

-.- Add pseudo-absences and covariates to WBS_RSF
(might need to reorder and change some columns)

```{r}
#rename anthropogenic risk column
WBS_RSF <- WBS_RSF %>%  rename(reprojanth_risk_clp = anth_risk_clp)

#reorder columns to match Points_RSF
WBS_RSF <- WBS_RSF[, c(4, 1, 2, 3, 5, 6, 7, 8, 9, 10, 11)]

#combine WBS Presence and Pseudo Absence Points into one dataframe
RSF <- rbind(WBS_RSF, Points_RSF)
```

-.- Extract NDVI and DNDVI for both

_._ Build a habitat suitability model

```{r}
M <- glmer(PA ~ scale(indvi) + sclae(dndvi) + scale(TWI) + scale(D_wood) + scale(D_river) + scale(D_rdt1) + scale(D_rdt5) + scale(anthro) + scale(I(D_wood^2)) + scale(I(D_river)^2) + scale(I(D_rdt1)^2) + scale(I(D_rdt5)^2), data = WBS_RSF, family = binomial(link="logit"))
```

